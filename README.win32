
$Id: README.win32,v 1.37 2003/05/19 17:57:40 we7u Exp $

------------------------------------
Installing Xastir on Windows/Cygwin:
------------------------------------

Please Note:  It's beneficial to actually log in to your Windows
computer rather than skipping that step of the Windows login process
(Don't hit escape just to get rid of the dialog!).  If you log into
Windows properly, Cygwin will be able to figure out where to put your
home directory.  If you don't do this, you'll be referred to as
"unknown" and you won't have a home directory in Cygwin.  This means
there won't be a good place to put your Xastir startup files.  Of
course, log in as the same user each time in order for Cygwin to use
the proper home directory for you.

Explanation of this login box, for those that don't see it:  If you
have the option of running networking, you'll have a login box show
up when you first start up Windows.  It'll ask for you user name and
password, then let you in.  If you escape out of that dialog, Windows
may start right up but networking will be disabled.

If you don't see that box, there are two options that I know about,
either you or someone else set it up to auto-login with your user/
password combo, or you don't have networking installed at all.

The following steps direct you through installing Cygwin, Xastir, and
a few optional map libraries that Xastir can use.  Note that in most
of the places below where the directions state to type commands, this
must be done from within a Cygwin BASH shell, not a DOS window.
Where you are asked to edit files, it's best to use Wordpad instead
of Notepad, as Notepad doesn't do nice things to Unix-format files.

Cygwin now allows you to have Xwindows apps and Windows apps all on
the screen and visible at the same time!  The instructions here set
it up in that manner, so you can have Xastir as just another app on
your Windows desktop.


Step 1)  Install Cygwin, a free download.


Step 1a) Go to http://www.cygwin.com with your web browser.  Look
for the black and green Cygwin icon, then click on "Install now!".
This will load the Cygwin network installer program onto your
computer.  Remember where you install this program.  I put mine in
"c:\<login>\cygwin\setup.exe", for instance
"c:\hacker\cygwin\setup.exe".


Step 1b)  Find the "setup.exe" program and execute it either by:

  a) Clicking on it with File Explorer, or
  b) Start->Run->path to executable, or
  c) Opening a DOS window and typing the name.

This will start installing Cygwin over the network.  Answers to
provide to the program:

    Install from Internet (*)
    "C:\cygwin"
    Install For All Users
    Default Text File Type Unix (*)
    Local Package Directory "C:\hacker\cygwin"
    Select Your Internet Connection (choose one)
    Choose A Download Site (choose one near you if possible)

Note:  Responses above listed with a "(*)" are required.  Others are
up to the individual user to answer as they wish.  You'll get to a
"Progress" page where "setup.bz2" is downloaded from the 'net.  If
it hangs at this step, you may wish to "Cancel" and try another
server until you obtain this file and are presented with a list of
packages to install.


Step 1c)  Select Packages:  Leave the packages selected that were
selected by default, plus select the additional packages listed
below.  Note that enabling some of these packages causes others to
be selected as well, that's ok and necessary:

    Archive
        unzip
        zip
    Devel
        autoconf
        automake
        binutils
        cvs
        gcc
        make
        rcs
    Editors
        vim
    Graphics
        tiff (install sources for this one too? TBD)
    Interpreters
        m4
        perl (install 5.6.1 instead of 5.8.0)
    Libs
        curl
        curl-devel
        tcltk
    Text
        less
    Utils
        diff
        patch
    Web
        wget (or can use libcurl instead)
    XFree86
        XFree86-prog:Headers
        lesstif
 
In order to see the more detailed list of packages, you'll have to
click on the '+' symbols to the left of the various categories.
Clicking on the small circle with the two arrows will run you
through the various select/de-select options for each package.


Step 1d)  Click Next and the packages will get downloaded/installed.
Repeat the above if you have network difficulties, until the install
succeeds.

Some servers fail to download some files and require the user to
press enter between downloads when it fails on these files.  If this
happens, back up and select another server.


Step 1e)  At the end of the install it'll ask you if you wish to
create desktop icons and menu entries.  Definitely select these!
They will create a Black/Green Cygwin icon on the desktop and a
menu entry so that you can start Cygwin that way as well.  Click
"Finish".  Cygwin is now installed.  The Black/Green Cygwin icon
will start up a BASH window, without starting up Xwindows.  Think of
it as being similar to a DOS window, but with a lot more power.


Step 2)  Create shortcut for starting X:

Create a shortcut to C:\cygwin\usr\X11r6\bin\startxwin.bat from your
desktop.  This shortcut is the method you'll use to start up
Xwindows.

Change the properties on the shortcut so that it runs it from your
home directory on Cygwin, something like "c:\cygwin\home\<user>\"


Step 3)  Test Cygwin and create startup shortcuts:

Double-click on the shortcut you just made.  You should get a shell
window that looks very much like a DOS window.  It's a BASH shell
window and understands Unix commands instead of DOS commands.

When running this shortcut for the first time from WinXP, several
errors may occur.  Repeat as necessary until the BASH window appears
without incident.

Type "exit" and then press <Enter> to make the BASH window
disappear.

You should still see an 'X' in your system tray.  That's the
X-server running.  You can right-click on that and make it exit.


Step 4)  Create a file at C:\cygwin\home\<user>\ called ".cvsrc",
where the "<user>" part is your Windows login name.  Don't forget
the leading period in the filename as it's important.  For instance,
I created a file:  "C:\cygwin\home\hacker\.cvsrc".  The file should
contain the following lines:

    cvs -z3
    update -P -d
    status -v

Please note:  this file must be created in Unix format, not DOS format.
Do not use Notepad or other Windows tools to create the file, as CVS will
not recognize the contents.  Thanks to Kirk Mefford <kc2elo@softhome.net>
for noticing this.

Step 5)  Download Xastir sources.  Start up Xwindows using your
shortcut.  Type the five lines below into the shell exactly as
shown.  Hit <ENTER> when asked for a password during the last
command:

  cd ~
  mkdir src
  cd src
  cvs -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/xastir login 
  cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/xastir co xastir 

If you keep seeing "EOF" at the end of a short error message, it
means that the anonymous CVS server at SourceForge is overloaded.
Keep trying!

The end result when it succeeds  will be a new directory
"C:\cygwin\home\<user>\src\xastir\" which contains the full Xastir
source code.

Side Note:  Here's the coolest thing about CVS:  Once you've done
this initial source-code download, you'll never have to do the whole
Xastir download again.  You'll just go into the "src/xastir"
directory and type "cvs update", which will snag just the _changes_
to the files since you last updated, and is very fast.  Compile and
install at that point and you'll be running the latest developer's
version in just a few minutes!  It's easy to keep up with the
developers this way.


Step 6)  Configure/compile/install Xastir.  Type these commands into
the BASH shell, waiting until each one completes before typing the
next command:

    cd ~/src/xastir
    ./bootstrap.sh
    ./configure
    make
    make install

Ignore the "PACKAGE_* redefined" warnings.  They won't break
anything and are just an annoyance.

Once you get through the above commands, Xastir is compiled and
installed on your system, with minimal map support.  Later sections
of this document detail adding additional map libraries in order to
give you access to the full mapping capability of Xastir.


Step 7)  Create a link to the Xastir executable.  Type the following
commands into the BASH shell:

    cd ~
    ln -s /usr/local/bin/xastir xastir

That will create a symbolic link from your home directory to the
Xastir executable, to make it easier to run Xastir without typing
the long path each time.


Step 8)  Actually run the darn thing:

Let's start from scratch to make sure it all works.  Close any
Cygwin/BASH windows you may have.

Click on the shortcut you created to start Xwindows.

From the resulting BASH window, type "xastir &".  Xastir should
start up shortly.

Note:  Xastir has support for pocketAPRS, dosAPRS, WinAPRS, MacAPRS
and GNIS maps by default.  For additional types of maps, you'll need
to install some libraries, then recompile Xastir so that it knows to
use them.  See the instructions below.

The README.MAPS file has instructions for where to get maps and where
to put them under the Xastir heirarchy.

If you have any WinAPRS, dosAPRS, or pocketAPRS maps, now is a good
time to place them in the /cygwin/usr/local/xastir/maps folder (or a
subdirectory of it).  You can also use "*.geo" files and the
associated image files with Xastir.  You may place them in this
directory (or a subdirectory of it) as well.

What Xastir paths look like from within Windows (in case you're
moving maps around with Explorer):  Just prefix them all with
"cygwin/".  For instance, maps go into /cygwin/usr/local/xastir/maps
instead of /usr/local/xastir/maps.  Xastir will continue to see them
as "/usr/local/xastir/maps" though from inside Cygwin.  It kind of
looks like a miniature Unix box from inside Cygwin.

Run Windows in 15-bit color or better (32768 colors or more) or
you'll get lots of warnings about Xastir not being able to allocate
colors when it starts up, and the display will be rather stark
looking.

To set a new language or change the language current choice, use
this command line instead from inside an Xterm:

     xastir -l <language>

Current choices are: English Dutch French German Italian Portuguese
Spanish

This option will be stored in the users config file for the next
time Xastir is run. On new installs Xastir will default to English
unless you use this command line option.

Another difference with Cygwin as opposed to Unix-like operating
systems:  You can't do the make install portion if Xastir is up and
running.  You have to kill Xastir first before you do "make install"
or "make install-strip".

Note that one user running Cygwin on XP had it crash every time his
screensaver kicked in.  Disabling the screenserver fixed that
problem.

Please see the INSTALL file and the Help menu in Xastir itself
for additional information not mentioned in this document.



-------------------------------------------
OPTIONAL:  ADDING ADDITIONAL MAP LIBRARIES:
-------------------------------------------

These additional Xastir libraries have been tested on Cygwin:

    ImageMagick
    Shapelib
    libtiff
    libproj
    libgeotiff

Anyone testing additional libraries is encouraged to share their
findings on the Xastir mailing lists.



RECOMMENDED:  Adding Shapelib (tested with shapelib-1.2.10):
------------------------------------------------------------
Allows using many sources of online polygon, polyline, and point
maps, including ones from NOAA.  This is the only format used for
weather alert maps.

From a BASH shell, type:

    cd ~/src
    mkdir shapelib
    
Fetch "shapelib-1.2.10.tar.gz" from one of these sites:

    http://gdal.velocet.ca/projects/shapelib/index.html
or  http://wetnet.net/~we7u/xastir/shapelib/

Put it in the C:\cygwin\home\<user>\src\shapelib directory.  Untar it
from the BASH shell:

    cd ~/src/shapelib
    tar xzvf shapelib-1.2.10.tar.gz

1) Edit Shapelib's Makefile to remove the space after the "-h"
on the line that looks like this:

    /usr/bin/ld -G -h libshp.so.1 -o .libs/libshp.so.$(LIBSHP_VERSION) shpopen.lo shptree.lo dbfopen.lo -lc

Change it to this (one space missing):

    /usr/bin/ld -G -hlibshp.so.1 -o .libs/libshp.so.$(LIBSHP_VERSION) shpopen.lo shptree.lo dbfopen.lo -lc


then type:

    cd ~/src/shapelib/shapelib-1.2.10
    make lib

You may get the "undefined reference impure_ptr" messages.  If so,
edit the file /usr/include/sys/reent.h to remove the word "extern"
from this line:

    extern struct _reent *_impure_ptr __ATTRIBUTE_IMPURE_PTR__;

then try "make lib" again.

    make lib_install

If you get "cp: cannot stat `.libs/libshp.la': No such file or
directory", then you forgot to edit the Makefile.  BZZZT!  Please
start again at step 1) above.  Thank you for playing!

Edit or create your .profile file in your home directory.

NOTE:  Your "home" directory would be at "C:\cygwin\<user>\" if you
installed Cygwin in the default location.  From inside a BASH shell
you can get to your home directory just by typing "cd" and then
pressing <Enter>.  When you see things like "~/.profile" it is
really referring to the file ".profile" in your home directory (~).
This is a different file than the ".bash_profile" file.

It appears that Cygwin uses the PATH variable to look for both
binaries and libraries.  Add this line to the file (create the
"~/.profile" file if the file doesn't exist):

    export PATH=$PATH:/lib:/usr/lib:/usr/X11R6/lib:/usr/local/lib:.

Now you should be ready to configure and compile Xastir with
Shapelib support.  Type these commands:

    cd ~/src/xastir
    ./configure
    make
    make install

The installed copy of Xastir should now have Shapelib support.  You
can download NOAA weather alert maps and many other sorts of maps,
and Xastir will recognize and use them.  Note that weather alert
shapefiles must go into the /usr/local/xastir/Counties directory.
All other shapefiles must go into the /cygwin/user/local/xastir/maps
directory.

See the README.MAPS file for where to get the maps.



OPTIONAL:  Adding ImageMagick (tested with ImageMagick 5.5.3):
--------------------------------------------------------------
Allows using more than 68 different graphics format files as maps,
by creating an associated .geo file for each with tiepoints.  This
support also allows use of online Tiger and Terraserver maps with
Xastir, and NOAA weather radar images.  Other people are working on
integrating even more online mapping sources.  This will also allow
you to use any GIF/JPG/XPM/BMP/... image as an Xastir map.

Note:  The Cygwin binary for ImageMagick-5.5.5 has a problem in it's
Magick-config script which makes it impossible to use for our
purposes.  Don't try to use that version.

Note:  The Cygwin binary for ImageMagick-5.5.6 fails at the link
stage trying to link to "liblcms", which is the "little cms engine"
library.  Don't try to use that version.

ImageMagick:
        http://www.imagemagick.org/

    cd ~/src
    mkdir imagemagick

Download the ImageMagick cygwin binary from www.imagemagick.org or
one of it's mirrors.  If you can't find the version you need, try
here:

    http://wetnet.net/~we7u/xastir/ImageMagick/cygwin/

Put it in the ~/src/imagemagick directory.
Extract the files:

    cd ~/src/imagemagick
    tar xzvf filename

Copy the files/directories into the /usr tree:

    cd ImageMagick-5.5.3
    cp -R * /usr

Reconfigure Xastir to use this library:

    cd ~/src/xastir
    ./configure

If "configure" did not find ImageMagick properly, edit the resulting
config.h file and change this line:

    /* #undef HAVE_IMAGEMAGICK */

to this:

    #define HAVE_IMAGEMAGICK 1


Finish the Xastir build and install:

    make
    make install

Add this to your ~/.profile file (note this is a different file than
the .bash_profile file):

    export MAGICK_HOME=/usr

Now on-line Tigermaps should work for you.  Unfortunately it looks
like the ".profile" file doesn't automatically get run if you start
up the X-server from a windows shortcut.  If you don't set the
MAGICK_HOME variable in your shell that you start Xastir from, then
ImageMagick will fail to display images and you'll get messages like
"No decode delegate for this image format" in the xterm you started
Xastir from.  If that happens, you can close Xastir, type

    .  ./.profile

and then type "xastir &" again to make it work.  Another option is
to start X from within a standard Cygwin window.  After starting X
you can close the original Cygwin window.  Yet another option is to
create a script for starting Xastir so that you can set the
MAGICK_HOME variable just before you start it.  It could look
something like this:

    #!/bin/sh
    export MAGICK_HOME=/usr
    xastir &

Perhaps name it "aprs".  Start it by typing "./aprs".

HIGHLY RECOMMENDED:  If you create a file called "terraserver.geo"
in the /usr/local/xastir/maps directory, containing the single line
"TERRASERVER", and select it with the Map Chooser, you should see
satellite images on the map screen.



OPTIONAL:  Install geoTIFF support:
-----------------------------------
Allows using USGS DRG topo maps or other types of geoTIFF
maps/images and has the ability to tile smaller maps into a larger
contiguous map of an area:

For geoTIFF support (such as USGS DRG topo maps) you need one each
of libproj, proj-nad27, and libgeotiff:


    libproj (tested with proj-4.4.7):
    ---------------------------------
        http://www.remotesensing.org/proj/
or      http://wetnet.net/~we7u/xastir/libproj/


    Datum translations (tested with proj-nad27-1.1):
    ------------------------------------------------
        ftp://ftp.remotesensing.org/pub/proj/
or      http://wetnet.net/~we7u/xastir/libproj/


    libgeotiff (tested with libgeotiff-1.2.0):
    ------------------------------------------
        http://www.remotesensing.org/geotiff/geotiff.html
or      ftp://ftp.remotesensing.org/pub/geotiff/libgeotiff/
or      http://wetnet.net/~we7u/xastir/libgeotiff/


Please note that the order of installation for these libraries is
critical.  Follow the instructions below carefully.



Adding libproj to Cygwin (tested with proj-4.4.7):
--------------------------------------------------

NOTE: You must install libproj BEFORE compiling libgeotiff, because
libgeotiff uses libproj to do the datum translations. If you install
libgeotiff first, datum translations won't work.

    cd ~/src
    mkdir libproj

Download the libproj and proj-nad27 files and place them in the
~/src/libproj directory.

The proj-nad27-1.1.tar.gz must be decompressed in the nad
subdirectory of the proj distribution directory before you run
configure.
    
    cd ~/src/libproj    
    tar xzvf proj-4.4.7.tar.gz
    cd proj-4.4.7/nad
    tar xzvf ../../proj-nad27-1.1.tar.gz
    cd ..
    ./configure
    make
    make install


These next few commands are required for now, but once libgeotiff is
fixed so that it finds libproj properly on Cygwin, they'll be
removed from the libproj instructions:

    cd /usr/lib
    ln -s /usr/local/lib/libproj.a
    ln -s /usr/local/lib/libproj.la


Adding libgeotiff (tested with libgeotiff-1.2.0):
-------------------------------------------------

    cd ~/src
    mkdir libgeotiff

Download libgeotiff-1.2.0 and place it in the libgeotiff
subdirectory.

    cd ~/src/libgeotiff
    tar xzvf libgeotiff-1.2.0.tar.gz
    cd libgeotiff-1.2.0
    ./configure
    make
    make install

If you must re-run "configure" for any of these libraries, remember
to delete "config.status" and "config.cache" files first.

You may get the "undefined reference impure_ptr" messages (just like
with Shapelib above).  If so, edit the file /usr/include/sys/reent.h
to remove the word "extern" from this line:

    extern struct _reent *_impure_ptr __ATTRIBUTE_IMPURE_PTR__;

then try "make" and "make install" again.

I've had it compile all the way through, but I've also had it bomb
out when it gets to the "ld -shared" step.  At that point it writes
a lot of "undefined reference" messages.  The line at which the
compile might fail:


    ld -shared xtiff.o geo_free.o geo_get.o geo_names.o geo_new.o
    geo_print.o geo_set.o geo_tiffp.o geo_write.o geo_trans.o
    geo_normalize.o geotiff_proj4.o geo_extra.o cpl_serv.o cpl_csv.o -lproj
    -ltiff -ljpeg -lz -lm -L/usr/local/lib -o libgeotiff.so.1.1.5


To fix this, edit the Makefile to add "-lc" to the end of the LIBS
line and run "make" again, then "make install".


TEMPORARY:  It looks like we need to switch to a newer version of
the libtiff DLL in order to work with libgeotiff:

    cd /bin
    mv cygtiff3.dll cygtiff3.dll.old
    cp cygtiff3.dll.new cygtiff3.dll


Set up Xastir to use the new geotiff libraries:

    cd ~/src/xastir
    ./configure
    make
    make install

It should find libtiff/libproj/libgeotiff at the configure stage and
compile in support for geotiff maps.  You should now be able to use
USGS geoTIFF topo maps, and see them tiled together in the map
window into a continuous map.


How to make Sound Alerts work under Cygwin
------------------------------------------
(from Kirk Mefford, kc2elo)
"I figured I'd share exactly what I did to make the sound alerts work in
xastir under Cygwin. Sound support seems to be just one of the many quirks
of trying to use *nix native software under Microsoft OS's. Hope this helps
someone else.

FYI: This was tested under Win2000

Sound alert support under Cygwin using Network Audio Server (NAS)

I downloaded http://nas.intra-links.net/files/nas-1.6-win-binary.zip and
decompressed the archive with winzip (any zip utility should work fine) into
a temporary folder.

I deleted the "cygwin1.dll" and "README.txt" files that came in the package
since they aren't needed and the extra cygwin1.dll can cause problems.

Then copy the remaining files from the package into the /bin directory under
cygwin.

All that is needed to make nas available to xastir is to load the server
before running xastir.

To load NAS for xastir to use simply type "nasd -local -b" from cygwin. This
command will load the NAS server in the background and will only allow local
users to access it.  For more command options type "nasd -help" from within
cygwin.

After NAS is loaded you can load xastir as you normally would.

Once xastir is running, to play sound alerts you need to change the default
configuation to use "auplay"

From within xastir click on File>Configure>Audio Alarms.
The "Audio Play Command" box should be changed to "auplay"
Then ensure the audio files listed to play are located in
"/usr/local/xastir/sounds" directory.

Click ok to accept the changes and be sure to save your config before
exiting xastir or sound will not work the next time it is loaded.

Turn up the volume on your PC speakers and enjoy the noise xastir makes."

